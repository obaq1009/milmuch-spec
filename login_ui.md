# ログイン画面仕様（Login UI）

- Status: ACTIVE
- Version: v1.0
- Last Updated: 2025-12-16
- Owner: milmuch / ChatGPT
- Target: Ruby on Rails 7.x
- Depends On:
  - Authentication & Ownership v1.0（users/roles/has_secure_password）

---

## 1. 目的
- ID（メールアドレス）＋パスワードでログインできるようにする
- ログインしないとシステムの主要画面へアクセスできないようにする
- 担当者別の表示・編集制御の前提となる

---

## 2. 画面一覧
- AUTH-01：ログイン画面
- AUTH-02：ログアウト（画面ではなく動作）
- AUTH-03：ログイン必須リダイレクト（動作）

※ パスワードリセットは v2（本仕様では対象外）

---

## 3. AUTH-01 ログイン画面

### 3.1 URL
- GET `/login`
- POST `/login`

### 3.2 表示要素（必須）
- タイトル：`ログイン`
- 入力欄：
  - メールアドレス（type=email）
  - パスワード（type=password）
- ボタン：
  - `ログイン`
- エラーメッセージ表示領域（入力欄の下 or 上部）

### 3.3 入力バリデーション
- メールアドレス：必須、前後空白トリム
- パスワード：必須
- エラー文言（固定）：
  - `メールアドレスまたはパスワードが違います。`
  - ※ セキュリティ上、どちらが間違いかは出さない

### 3.4 成功時の遷移
- ログイン成功 → `/matching/projects` に遷移

### 3.5 失敗時の挙動
- 同じ `/login` に戻す（ステータス 422 推奨）
- 入力したメールアドレスは保持、パスワードはクリア
- エラー文言を表示

### 3.6 画面の見た目（MVP）
- 余計なリンクは置かない
- ロゴ/社名（任意）：`milmuch`

---

## 4. AUTH-02 ログアウト

### 4.1 URL
- POST `/logout`（推奨）
  - CSRF対策のため GET logout は避ける

### 4.2 挙動
- セッションを破棄
- `/login` にリダイレクト
- フラッシュ：`ログアウトしました。`（任意）

### 4.3 UI導線
- ログイン後の全画面共通ヘッダー右上に `ログアウト`

---

## 5. AUTH-03 ログイン必須リダイレクト

### 5.1 対象
- `/login` 以外の画面（基本全て）

### 5.2 ルール
- 未ログインでアクセス → `/login` にリダイレクト
- 任意：アクセス元URLを session に保持し、ログイン後に戻す（v1.1）

---

## 6. セッション仕様（Rails）
- 認証はセッション方式
- セッションに保存する情報：
  - `current_user_id`

---

## 7. 権限制御（関連：MVP）
ログイン後、以下の権限制御を行う（別仕様の再掲）。

- admin：全アクセス可
- sales：自分のデータ編集可、他人のデータは閲覧不可（or read-only）
- viewer：閲覧のみ（MVPでは省略可）

---

## 8. 監査ログ（任意：v1.1）
- ログイン成功時：user_id、timestamp、IPをログ出し（CloudWatch）
- ログアウトも同様（任意）

---

## 9. 受入基準（Acceptance Criteria）
- 正しいメールアドレス＋パスワードでログインできる
- 間違った入力では共通エラーメッセージが出る
- 未ログインで `/matching/projects` にアクセスすると `/login` に飛ぶ
- ログアウトでセッションが切れ、再度ログインが必要になる

---

## 10. 非スコープ（v2）
- パスワードリセット
- 2FA
- SSO（Microsoft/Google）

---
