# 案件詳細画面仕様（Project Detail UI）

- Status: ACTIVE
- Version: v1.0
- Last Updated: 2025-12-16
- Owner: milmuch / ChatGPT
- Target: Ruby on Rails 7.x
- Depends On:
  - Project List UI v1.0
  - Classification / Extraction / Normalizer
  - Proposal Template v1.1（原文保持）
  - Matching Rules v1.1（マージン込み）

---

## 1. 目的
案件一覧では判断しきれない場合に、
**原文確認・条件確認・添付確認**を安全かつ効率的に行う。

- 一覧画面の思考を止めない
- 詳細は「必要な人だけが開く」
- 原文を崩さず、トラブルを防止する

---

## 2. URL / 画面名
- GET `/matching/projects/:id`
- 画面名：案件詳細

※ 一覧画面（/matching/projects）からの遷移が主  
※ 新規タブ or モーダル表示でも可（MVPは画面遷移でOK）

---

## 3. 画面構成（重要）

### 上部：サマリー（常に表示）
### 下部：アコーディオン（必要な人だけ展開）

※ **全情報をベタ表示しない**（Qoala準拠）

---

## 4. 上部サマリー（MVP必須）

### 4.1 表示項目
- 案件名（project.title / subject）
- 単価
  - `min-max` / `～max` / `price_text`
- 勤務地（location_text）
- リモート（remote_type バッジ）
- 期間（start_text）
- 必須スキル（skills_required：全件表示）
- 尚可スキル（skills_optional：全件表示）
- 面談回数（interview_count）
- 募集人数（positions）
- 外国籍条件（nationality_rule）
- 商流（flow_rule：あれば）

### 4.2 表示ルール
- サマリーだけで「扱う価値があるか」が判断できること
- 単価・必須スキル・リモートは特に目立たせる

---

## 5. 下部アコーディオン構成（MVP）

### 🔽 A-1：案件原文（最重要）
**目的：原文確認・トラブル防止**

- メール本文（Email.body_text）
- **改変なし**
- 引用形式で表示（各行に `>` を付与）

表示例：案件：Javaツール改修
内容：某大手金融業様の使用しているツールのモダナイゼーション…

---

### 🔽 A-2：条件詳細
**目的：交渉・可否判断**

表示項目（あれば）：
- 精算幅（settlement_min_h – settlement_max_h）
- 勤務時間
- 年齢制限（age_rule）
- 支払いサイト
- 商流詳細
- 備考（備考欄全文）

---

### 🔽 A-3：スキル詳細
**目的：マッチ理由の裏取り**

- 必須スキル（skills_required：全件）
- 尚可スキル（skills_optional：全件）
- 抽出結果をそのまま表示
- 正規化済みのスキル名を表示

---

### 🔽 A-4：添付ファイル
**目的：客先資料・補足確認**

- 添付一覧（ActiveStorage）
- 表示：
  - ファイル名
  - 種別（PDF / Excel 等）
  - サイズ
- 操作：
  - ダウンロード
  - プレビュー（v2以降）

---

### 🔽 A-5：システム情報（内部用）
**目的：管理・デバッグ**

- 受信日時（sent_at）
- 送信元ドメイン
- parser_version
- needs_review フラグ
- 抽出エラー有無（あれば）

※ admin のみ表示（sales には非表示推奨）

---

## 6. 画面内アクション（MVP）

### 6.1 基本アクション
- [一覧に戻る]
- [案件一覧でこの案件を選択状態にする]（任意）

### 6.2 営業アクション（任意）
- [案件マージン編集]（権限：sales以上）
- [候補人材を見る]（/matching/projects 右カラムへ戻る）

---

## 7. UXルール（重要）
- 初期状態では **全アコーディオンは閉じる**
- 最重要の「案件原文」は一番上に配置
- 展開・折りたたみはワンクリック
- 一覧画面からの思考を壊さない

---

## 8. 受入基準（Acceptance Criteria）
- 一覧画面から案件詳細に遷移できる
- サマリーだけで案件の全体像が把握できる
- 原文が改変なしで表示される
- 必要な条件・スキル・添付がアコーディオンで確認できる
- admin のみシステム情報が見える

---

## 9. 非スコープ（v2以降）
- 添付ファイルの全文検索
- 原文の自動要約（AI）
- 条件差分の自動ハイライト

---
